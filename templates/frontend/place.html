{% extends "frontend/base.html" %}
{% block title %}{{ place.title }} ‚Äî Holy Dham{% endblock %}
{% set vis = visibility or {} %}
{% set kp_colors = ['#2E86AB','#A23B72','#F18F01','#3B7A57','#6C5CE7','#E84855','#2AB7CA','#8B5E3C','#5C6BC0','#00897B','#E67E22','#8E44AD'] %}

{% block content %}
<!-- Hero -->
<section class="hero-section" style="background:linear-gradient(135deg,#2D1F2E 0%,#4A2D4E 60%,#6B3A6E 100%);padding:70px 0 55px;color:white;position:relative;overflow:hidden">
<div style="position:absolute;inset:0;background:url('/static/uploads/{{ place.featured_image }}') center/cover;opacity:.12"></div>
<div style="position:absolute;inset:0;background:radial-gradient(ellipse at 30% 80%,rgba(199,107,143,.15),transparent 60%)"></div>
<div class="container" style="position:relative;z-index:1">
<div style="display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,.1);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.15);border-radius:50px;padding:6px 16px;margin-bottom:16px">
  <span style="font-size:14px">üôè</span>
  <span style="font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:600;letter-spacing:1px;text-transform:uppercase;opacity:.9">Tier 1 ¬∑ Holy Dham</span>
</div>
{% if vis.get('tags',1) and tags %}<div style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap">{% for tag in tags %}<span style="background:{{ tag.color }}22;border:1px solid {{ tag.color }}55;color:{{ tag.color }};padding:4px 14px;border-radius:50px;font-size:12px;font-weight:600;font-family:'Plus Jakarta Sans',sans-serif">{{ tag.name }}</span>{% endfor %}</div>{% endif %}
<h1 style="font-family:'Josefin Sans',sans-serif;font-size:clamp(30px,5vw,54px);font-weight:700;margin-bottom:12px">{{ place.title }}</h1>
{% if vis.get('city',1) or vis.get('state',1) %}<p style="font-size:17px;opacity:.85;display:flex;align-items:center;gap:8px;font-family:'Plus Jakarta Sans',sans-serif"><span>üìç</span>{% if vis.get('city',1) and place.city %}{{ place.city }}{% endif %}{% if vis.get('city',1) and place.city and vis.get('state',1) and place.state %}, {% endif %}{% if vis.get('state',1) and place.state %}{{ place.state }}{% endif %}{% if vis.get('country',1) and place.country %}, {{ place.country }}{% endif %}</p>{% endif %}
{% if vis.get('short_description',1) and place.short_description %}<p style="max-width:700px;font-size:15px;line-height:1.7;opacity:.7;margin-top:12px;font-family:'Josefin Sans',sans-serif;font-weight:300">{{ place.short_description }}</p>{% endif %}
<!-- Hierarchy Stats Bar -->
{% if hierarchy %}<div class="hero-stats" style="display:flex;gap:24px;margin-top:24px;padding:16px 20px;background:rgba(255,255,255,.08);backdrop-filter:blur(6px);border-radius:14px;border:1px solid rgba(255,255,255,.1);font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;flex-wrap:wrap">
<div><span style="opacity:.5">Key Places</span> <strong style="margin-left:4px">{{ hierarchy|length }}</strong></div>
{% set total_spots = namespace(val=0) %}{% set total_subs = namespace(val=0) %}{% for h in hierarchy %}{% for ks in h.key_spots %}{% set total_spots.val = total_spots.val + 1 %}{% set total_subs.val = total_subs.val + ks.sub_spots|length %}{% endfor %}{% endfor %}
<div><span style="opacity:.5">Key Spots</span> <strong style="margin-left:4px">{{ total_spots.val }}</strong></div>
<div><span style="opacity:.5">Key Points</span> <strong style="margin-left:4px">{{ total_subs.val }}</strong></div>
<div style="margin-left:auto;opacity:.5">üëÅÔ∏è {{ place.view_count or 0 }} views</div>
</div>{% endif %}
</div>
</section>

<!-- Main Content -->
<section style="padding:50px 0">
<div class="container tier-grid" style="display:grid;grid-template-columns:1fr 340px;gap:40px;align-items:start">
<!-- Left Column -->
<div>

{% if vis.get('featured_image',1) and place.featured_image %}
<div class="featured-img-wrap" style="margin-bottom:32px;border-radius:16px;overflow:hidden;box-shadow:0 4px 24px rgba(0,0,0,.08)">
<img src="/static/uploads/{{ place.featured_image }}" alt="{{ place.title }}" style="width:100%;display:block" onerror="this.parentElement.style.display='none'">
</div>{% endif %}

<!-- T1 Gallery Slider -->
{% set t1_gallery = [] %}
{% set t1_captions = {} %}
{% for m in media if m.file_type == 'image' and m.filename != place.featured_image %}
  {% if t1_gallery.append(m.filename) %}{% endif %}
  {% if m.caption %}{% if t1_captions.update({m.filename: m.caption}) %}{% endif %}{% endif %}
{% endfor %}
{% if t1_gallery|length > 0 %}
<div style="margin-bottom:32px">
<h3 style="font-family:'Josefin Sans',sans-serif;font-size:18px;font-weight:700;margin-bottom:12px;display:flex;align-items:center;gap:8px">üì∏ Photo Gallery <span style="font-size:12px;font-weight:500;color:var(--text-light);font-family:'Plus Jakarta Sans',sans-serif">{{ t1_gallery|length }} images</span></h3>
{% with gallery_images=t1_gallery, slider_id='t1', gallery_captions=t1_captions %}{% include 'frontend/_gallery_slider.html' %}{% endwith %}
</div>
{% endif %}

{% if vis.get('full_content',1) and place.full_content %}
<div class="rich-content" style="margin-bottom:40px;line-height:1.9;font-size:16.5px;color:var(--text-mid);font-family:'Nunito Sans',sans-serif">{{ place.full_content|safe }}</div>{% endif %}

<!-- Custom Fields -->
{% if custom_values %}
<div style="margin-bottom:40px">{% for cv in custom_values %}{% if cv.value %}
<div class="cf-block" style="background:var(--cream-dark);border-radius:14px;padding:20px;margin-bottom:12px">
<h4 style="font-size:14px;font-weight:700;color:var(--text-dark);margin-bottom:10px;display:flex;align-items:center;gap:8px;font-family:'Plus Jakarta Sans',sans-serif">
{% if cv.field_type == 'audio' %}üéµ{% elif cv.field_type == 'video' %}üé¨{% elif cv.field_type == 'url' %}üîó{% else %}üìã{% endif %} {{ cv.label }}</h4>
{% if cv.name in ('external_audio_url',) and cv.field_type == 'url' %}
<div style="background:linear-gradient(135deg,#1a1228,#2d1f3e);border-radius:16px;padding:24px;color:white"><div style="display:flex;align-items:center;gap:14px;margin-bottom:16px"><div style="width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,var(--rose-deep),#E89B4F);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0">üéµ</div><div><div style="font-family:'Josefin Sans',sans-serif;font-weight:600">{{ cv.label }}</div><div style="font-size:12px;opacity:.5">{{ place.title }}</div></div></div><audio controls style="width:100%;height:40px;filter:hue-rotate(300deg) saturate(1.2)"><source src="{{ cv.value }}"></audio></div>
{% elif cv.name in ('external_video_url',) and cv.field_type == 'url' %}
{% if 'youtube' in cv.value or 'youtu.be' in cv.value %}<div style="border-radius:14px;overflow:hidden;box-shadow:0 8px 30px rgba(0,0,0,.12)"><div style="position:relative;padding-bottom:56.25%"><iframe src="{{ cv.value.replace('watch?v=','embed/').replace('youtu.be/','youtube.com/embed/') }}" style="position:absolute;inset:0;width:100%;height:100%;border:0" allowfullscreen></iframe></div></div>
{% elif 'vimeo' in cv.value %}<div style="border-radius:14px;overflow:hidden"><div style="position:relative;padding-bottom:56.25%"><iframe src="https://player.vimeo.com/video/{{ cv.value.split('/')[-1] }}" style="position:absolute;inset:0;width:100%;height:100%;border:0" allowfullscreen></iframe></div></div>
{% else %}<video controls style="width:100%;border-radius:14px"><source src="{{ cv.value }}"></video>{% endif %}
{% elif cv.field_type == 'url' %}<a href="{{ cv.value }}" target="_blank" style="color:var(--rose-deep);text-decoration:underline">{{ cv.value }}</a>
{% elif cv.field_type == 'richtext' %}<div style="line-height:1.7;color:var(--text-mid)">{{ cv.value|safe }}</div>
{% elif cv.field_type == 'image' %}<img src="/static/uploads/{{ cv.value }}" style="width:100%;border-radius:10px" alt="{{ cv.label }}">
{% elif cv.field_type == 'images' %}{% set imgs = cv.value.split(',') %}{% set clean_imgs = [] %}{% for img in imgs %}{% if img.strip() %}{% if clean_imgs.append(img.strip()) %}{% endif %}{% endif %}{% endfor %}
{% if clean_imgs|length > 0 %}
{% with gallery_images=clean_imgs, slider_id='t1cf' ~ loop.index %}{% include 'frontend/_gallery_slider.html' %}{% endwith %}
{% endif %}
{% elif cv.field_type == 'audio' %}<audio controls style="width:100%"><source src="/static/uploads/{{ cv.value }}"></audio>
{% elif cv.field_type == 'video' %}{% if 'youtube' in cv.value or 'youtu.be' in cv.value %}<div style="position:relative;padding-bottom:56.25%;border-radius:10px;overflow:hidden"><iframe src="{{ cv.value.replace('watch?v=','embed/').replace('youtu.be/','youtube.com/embed/') }}" style="position:absolute;inset:0;width:100%;height:100%;border:0" allowfullscreen></iframe></div>{% else %}<video controls style="width:100%;border-radius:10px"><source src="/static/uploads/{{ cv.value }}"></video>{% endif %}
{% else %}<p style="color:var(--text-mid);line-height:1.6">{{ cv.value }}</p>{% endif %}
</div>{% endif %}{% endfor %}</div>{% endif %}

<!-- ‚ïê‚ïê‚ïê 4-TIER HIERARCHY VISUALIZATION ‚ïê‚ïê‚ïê -->
{% if hierarchy %}
<div style="margin-bottom:40px">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:24px">
  <h2 class="explore-title" style="font-family:'Josefin Sans',sans-serif;font-size:30px;font-weight:700;color:var(--text-dark)">Explore {{ place.title }}</h2>
</div>

<!-- Tier Legend -->
<div class="tier-legend" style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:24px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px">
<span style="display:inline-flex;align-items:center;gap:5px;padding:5px 12px;border-radius:50px;background:#2E86AB15;color:#2E86AB;font-weight:600;border:1px solid #2E86AB30"><span style="width:8px;height:8px;border-radius:50%;background:#2E86AB"></span> Tier 2 ¬∑ Key Places</span>
<span style="display:inline-flex;align-items:center;gap:5px;padding:5px 12px;border-radius:50px;background:#E7484515;color:#E74845;font-weight:600;border:1px solid #E7484530"><span style="width:8px;height:8px;border-radius:50%;background:#E74845"></span> Tier 3 ¬∑ Key Spots</span>
<span style="display:inline-flex;align-items:center;gap:5px;padding:5px 12px;border-radius:50px;background:#9C27B015;color:#9C27B0;font-weight:600;border:1px solid #9C27B030"><span style="width:8px;height:8px;border-radius:50%;background:#9C27B0"></span> Tier 4 ¬∑ Key Points</span>
</div>

{% for h in hierarchy %}
{% set kp = h.place %}
{% set ci = loop.index0 % kp_colors|length %}
{% set accent = kp_colors[ci] %}

<!-- TIER 2: Key Place Card -->
<div class="kp-card" style="border-radius:18px;overflow:hidden;margin-bottom:20px;border:2px solid {{ accent }}20;background:white;transition:all .3s" onmouseover="this.style.boxShadow='0 8px 30px {{ accent }}12'" onmouseout="this.style.boxShadow='none'">
<div class="kp-toggle" onclick="this.parentElement.classList.toggle('kp-open')" style="padding:20px 24px;cursor:pointer;display:flex;align-items:center;gap:14px;background:linear-gradient(135deg,{{ accent }}06,{{ accent }}03);user-select:none">
  <span style="width:40px;height:40px;background:{{ accent }};color:white;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;font-family:'Plus Jakarta Sans',sans-serif;flex-shrink:0">{{ loop.index }}</span>
  <div style="flex:1;min-width:0">
    <div style="display:flex;align-items:center;gap:8px"><span style="font-size:9px;letter-spacing:1.5px;text-transform:uppercase;color:{{ accent }};font-weight:700;font-family:'Plus Jakarta Sans',sans-serif">Tier 2 ¬∑ Key Place</span></div>
    <h3 style="font-family:'Josefin Sans',sans-serif;font-size:22px;font-weight:600;color:var(--text-dark);margin:4px 0 0">{{ kp.title }}</h3>
    {% if kp.short_description %}<p style="font-size:13px;color:var(--text-light);margin:4px 0 0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">{{ kp.short_description }}</p>{% endif %}
  </div>
  <div class="kp-count" style="text-align:center;font-family:'Plus Jakarta Sans',sans-serif;font-size:11px;color:var(--text-light);padding:0 12px;flex-shrink:0">
    {% if h.key_spots %}<div style="font-size:20px;font-weight:700;color:{{ accent }}">{{ h.key_spots|length }}</div><div>spots</div>{% endif %}
  </div>
  <svg class="kp-chevron" style="width:20px;height:20px;flex-shrink:0;color:{{ accent }};transition:transform .3s" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
</div>

<div class="kp-body">
<div class="kp-body-inner" style="padding:0 24px 24px;border-top:2px solid {{ accent }}10">
  {% if kp.full_content %}<div style="line-height:1.7;color:var(--text-mid);font-size:14px;margin:16px 0;font-family:'Nunito Sans',sans-serif">{{ kp.full_content|safe }}</div>{% endif %}
  <a href="{{ url_for('key_place_detail', slug=place.slug, kp_slug=kp.slug) }}" style="display:inline-flex;align-items:center;gap:6px;padding:8px 18px;background:{{ accent }};color:white;border-radius:50px;font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:600;text-decoration:none;margin-bottom:16px">View Full Details ‚Üí</a>

  <!-- TIER 3: Key Spots Grid -->
  {% if h.key_spots %}
  <div style="margin-top:8px">
    <h4 style="font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--text-light);margin-bottom:12px">üî∏ Key Spots in {{ kp.title }}</h4>
    <div class="ks-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px">
    {% for ksd in h.key_spots %}
    {% set ks = ksd.spot %}
    <a href="{{ url_for('key_spot_detail', slug=place.slug, kp_slug=kp.slug, ks_slug=ks.slug) }}" style="display:block;background:var(--cream);border-radius:14px;padding:16px;text-decoration:none;color:inherit;border:1px solid var(--border);transition:all .25s;position:relative;overflow:hidden" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 20px rgba(0,0,0,.08)'" onmouseout="this.style.transform='none';this.style.boxShadow='none'">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px">
        <span style="width:32px;height:32px;background:{{ ks.cat_color or '#666' }}15;border:1px solid {{ ks.cat_color or '#666' }}30;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0">{{ ks.cat_icon or 'üìç' }}</span>
        <div>
          <div style="font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:{{ ks.cat_color or '#666' }};font-family:'Plus Jakarta Sans',sans-serif">{{ ks.cat_name or 'Spot' }}</div>
          <h5 style="font-family:'Josefin Sans',sans-serif;font-size:16px;font-weight:600;color:var(--text-dark);margin:0;line-height:1.2">{{ ks.title }}</h5>
        </div>
      </div>
      {% if ks.short_description %}<p style="font-size:12px;color:var(--text-light);line-height:1.5;margin:0;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden">{{ ks.short_description }}</p>{% endif %}
      {% if ksd.sub_spots %}<div style="margin-top:8px;display:flex;align-items:center;gap:4px;font-size:11px;color:var(--text-light);font-family:'Plus Jakarta Sans',sans-serif"><span style="width:6px;height:6px;border-radius:50%;background:#9C27B0"></span> {{ ksd.sub_spots|length }} key-point{{ 's' if ksd.sub_spots|length > 1 }}</div>{% endif %}
    </a>
    {% endfor %}
    </div>
  </div>
  {% endif %}
</div>
</div>
</div>
{% endfor %}
</div>
{% endif %}

<!-- Related Content -->
{% if related_entries %}
<div style="margin-bottom:40px">
<h2 style="font-family:'Josefin Sans',sans-serif;font-size:26px;font-weight:700;margin-bottom:20px">üìñ Related Content</h2>
<div style="display:grid;gap:12px">{% for entry in related_entries %}
<a href="{{ url_for('entry_detail', mod_slug=entry.module_slug, entry_slug=entry.slug) }}" style="display:flex;align-items:center;gap:14px;padding:16px;background:var(--cream-dark);border-radius:12px;text-decoration:none;color:inherit;transition:all .2s" onmouseover="this.style.transform='translateX(4px)'" onmouseout="this.style.transform='none'">
<span style="font-size:24px">{{ entry.module_icon }}</span><div><strong style="color:var(--text-dark)">{{ entry.title }}</strong><br><span style="font-size:12px;color:var(--text-light)">{{ entry.module_name }}</span></div></a>{% endfor %}</div></div>{% endif %}
</div>

<!-- Right Sidebar -->
<div>
<div class="sidebar-card" style="background:white;border:2px solid var(--border);border-radius:16px;padding:24px;margin-bottom:24px">
<h3 style="font-family:'Josefin Sans',sans-serif;font-size:20px;font-weight:700;margin-bottom:16px">Quick Info</h3>
<div style="display:flex;flex-direction:column;gap:12px;font-family:'Plus Jakarta Sans',sans-serif;font-size:15px">
{% if vis.get('city',1) and place.city %}<div class="quick-info-row" style="display:flex;justify-content:space-between"><span style="color:var(--text-light)">City</span><strong>{{ place.city }}</strong></div>{% endif %}
{% if vis.get('state',1) and place.state %}<div class="quick-info-row" style="display:flex;justify-content:space-between"><span style="color:var(--text-light)">State</span><strong>{{ place.state }}</strong></div>{% endif %}
{% if vis.get('country',1) and place.country %}<div class="quick-info-row" style="display:flex;justify-content:space-between"><span style="color:var(--text-light)">Country</span><strong>{{ place.country }}</strong></div>{% endif %}
{% for cv in custom_values %}{% if cv.value and cv.field_type in ('text','number') %}<div class="quick-info-row" style="display:flex;justify-content:space-between;gap:12px"><span style="color:var(--text-light);white-space:nowrap;display:flex;align-items:center;gap:4px"><span style="font-size:14px">{{ cv.field_icon or 'üìã' }}</span> {{ cv.label }}</span><strong style="text-align:right">{{ cv.value }}</strong></div>{% endif %}{% endfor %}
</div>

<!-- Hierarchy Navigation with Tier Definitions -->
{% if hierarchy %}
<div style="margin-top:20px;padding-top:16px;border-top:1px solid var(--border)">
<h4 style="font-size:13px;margin-bottom:6px;color:var(--text-light);font-weight:700;letter-spacing:1px;text-transform:uppercase">Dham Hierarchy</h4>
<p style="font-size:11px;color:var(--text-light);line-height:1.5;margin-bottom:10px;opacity:.7">This dham is organized into 4 tiers. Browse from the broadest sacred region down to exact meditation points.</p>

<!-- How hierarchy works - right below subtitle -->
<div style="margin-bottom:14px;padding:10px 12px;background:var(--cream-dark);border-radius:10px">
<div style="font-size:9px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text-light);margin-bottom:6px">How this hierarchy works</div>
<div style="display:flex;flex-direction:column;gap:4px;font-size:10px;color:var(--text-mid);line-height:1.4">
<div><span style="color:#C76B8F;font-weight:700">T1 Holy Dham</span> ‚Üí Sacred region of pastimes</div>
<div style="padding-left:8px"><span style="color:#2E86AB;font-weight:700">T2 Key Places</span> ‚Üí Major zones & pilgrimage stops</div>
<div style="padding-left:16px"><span style="color:#E74845;font-weight:700">T3 Key Spots</span> ‚Üí Specific leela locations</div>
<div style="padding-left:24px"><span style="color:#9C27B0;font-weight:700">T4 Key Points</span> ‚Üí Exact meditation micro-points</div>
</div>
</div>

<!-- Tier 1 indicator -->
<div style="background:#C76B8F08;border:1px solid #C76B8F20;border-radius:10px;padding:10px 12px;margin-bottom:14px">
<div style="display:flex;align-items:center;gap:6px;margin-bottom:4px">
<span style="font-size:8px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;padding:2px 7px;background:#C76B8F;color:white;border-radius:50px">T1</span>
<span style="font-size:12px;font-weight:700;color:#C76B8F">üôè {{ place.title }}</span>
</div>
<p style="font-size:10px;color:var(--text-light);margin:0;line-height:1.4">The entire spiritual ecosystem ‚Äî a sacred region of divine pastimes.</p>
</div>

<!-- Tier 2 heading -->
<div style="display:flex;align-items:center;gap:6px;margin-bottom:8px">
<span style="font-size:8px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;padding:2px 7px;background:#2E86AB;color:white;border-radius:50px">T2</span>
<span style="font-size:11px;font-weight:700;color:#2E86AB">Key Places</span>
<span style="font-size:9px;color:var(--text-light)">‚Äî major zones within the dham</span>
</div>

{% for h in hierarchy %}
{% set ci = loop.index0 % kp_colors|length %}
{% set accent = kp_colors[ci] %}
<div style="margin-bottom:10px;padding-left:4px;border-left:2px solid {{ accent }}30">
<a href="{{ url_for('key_place_detail', slug=place.slug, kp_slug=h.place.slug) }}" style="display:flex;gap:8px;align-items:center;text-decoration:none;color:inherit;padding:5px 8px;font-weight:600;font-size:13px;border-radius:8px;transition:all .2s" onmouseover="this.style.background='{{ accent }}08';this.style.color='{{ accent }}'" onmouseout="this.style.background='none';this.style.color='inherit'">
<span style="width:20px;height:20px;background:{{ accent }};color:white;border-radius:5px;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;flex-shrink:0">{{ loop.index }}</span>{{ h.place.title }}</a>
{% if h.key_spots %}
<div style="padding-left:16px;margin-top:2px">
<div style="display:flex;align-items:center;gap:4px;margin-bottom:3px">
<span style="font-size:7px;font-weight:700;letter-spacing:1px;text-transform:uppercase;padding:1px 5px;background:#E7484510;color:#E74845;border-radius:50px;border:1px solid #E7484520">T3</span>
<span style="font-size:9px;color:var(--text-light)">Key Spots</span>
</div>
{% for ksd in h.key_spots %}
<a href="{{ url_for('key_spot_detail', slug=place.slug, kp_slug=h.place.slug, ks_slug=ksd.spot.slug) }}" style="display:flex;gap:5px;align-items:center;text-decoration:none;color:var(--text-light);padding:2px 6px;font-size:11px;transition:all .2s;border-radius:6px" onmouseover="this.style.color='{{ ksd.spot.cat_color or accent }}';this.style.background='{{ ksd.spot.cat_color or accent }}08'" onmouseout="this.style.color='var(--text-light)';this.style.background='none'">
<span style="font-size:11px">{{ ksd.spot.cat_icon or 'üìç' }}</span>{{ ksd.spot.title }}{% if ksd.sub_spots %}<span style="font-size:8px;padding:0 4px;background:#9C27B010;color:#9C27B0;border-radius:50px;margin-left:auto">{{ ksd.sub_spots|length }} T4</span>{% endif %}</a>
{% endfor %}
</div>{% endif %}
</div>{% endfor %}

</div>{% endif %}
</div>

{% if vis.get('latitude',1) and place.latitude and place.longitude %}
<div style="background:white;border:2px solid var(--border);border-radius:16px;overflow:hidden;margin-bottom:24px">
<iframe src="https://maps.google.com/maps?q={{ place.latitude }},{{ place.longitude }}&z=12&output=embed" style="width:100%;height:220px;border:0"></iframe></div>{% endif %}

{% if related %}
<div class="sidebar-card" style="background:white;border:2px solid var(--border);border-radius:16px;padding:24px">
<h3 style="font-family:'Josefin Sans',sans-serif;font-size:18px;font-weight:700;margin-bottom:16px">Similar Dhams</h3>
{% for rp in related %}<a href="{{ url_for('place_detail', slug=rp.slug) }}" style="display:block;padding:10px 0;border-bottom:1px solid var(--border);text-decoration:none;color:inherit"><strong style="color:var(--text-dark);font-size:14px">{{ rp.title }}</strong><p style="font-size:12px;color:var(--text-light);margin:4px 0 0">{{ rp.city }}{{ ', ' + rp.state if rp.state }}</p></a>{% endfor %}</div>{% endif %}
</div>
</div>
</section>

<!-- Give Feedback / Report Error Button -->
<section style="padding:20px 0 50px">
<div class="container" style="text-align:center">
<button class="report-btn" onclick="openReportModal(this.dataset.info)" data-info="&lt;strong&gt;üìç Page Info&lt;/strong&gt;&lt;br&gt;üèõÔ∏è &lt;b&gt;T1 Holy Dham:&lt;/b&gt; {{ place.title }}&lt;br&gt;üìç {{ place.city or '' }}{% if place.city and place.state %}, {% endif %}{{ place.state or '' }}{% if place.country %}, {{ place.country }}{% endif %}"><span class="rb-icon">‚úèÔ∏è</span> <span class="rb-feedback">Give Feedback</span> <span class="rb-sep">/</span> <span class="rb-error">Report Error</span></button>
</div>
</section>

<style>
.rich-content h2{font-family:'Josefin Sans',sans-serif;font-size:26px;margin:24px 0 12px;color:var(--text-dark);font-weight:700}
.rich-content h3{font-family:'Josefin Sans',sans-serif;font-size:22px;margin:20px 0 10px;color:var(--text-dark);font-weight:600}
.rich-content p{margin-bottom:12px}
.rich-content img{max-width:100%;border-radius:10px;margin:16px 0}
.kp-card .kp-body{max-height:0;overflow:hidden;transition:max-height .5s cubic-bezier(.23,1,.32,1)}
.kp-card.kp-open .kp-body{max-height:8000px}
.kp-card.kp-open .kp-chevron{transform:rotate(180deg)}
</style>
{% endblock %}
