{% extends "frontend/base.html" %}
{% block title %}{{ place.title }}{% endblock %}
{% block meta_desc %}{{ place.short_description }}{% endblock %}

{% block extra_css %}
<style>
.place-hero{padding:120px 0 40px;position:relative;overflow:hidden}
.place-hero-bg{position:absolute;inset:0;background:linear-gradient(135deg,var(--rose-pale),var(--cream),var(--sage-light));opacity:.3}
.place-hero-inner{position:relative;z-index:1;display:grid;grid-template-columns:1.2fr 1fr;gap:48px;align-items:center}
.place-hero-img{border-radius:24px;overflow:hidden;aspect-ratio:4/3;display:flex;align-items:center;justify-content:center;font-size:80px;background:linear-gradient(135deg,var(--cream-dark),var(--cream-deep))}
.place-tags{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
.place-tag{padding:6px 14px;border-radius:50px;font-family:'DM Sans',sans-serif;font-size:11px;font-weight:600;color:white}
.place-title{font-family:'Playfair Display',serif;font-size:clamp(32px,4vw,48px);margin-bottom:12px;line-height:1.15}
.place-location{font-family:'DM Sans',sans-serif;font-size:15px;color:var(--text-mid);display:flex;align-items:center;gap:8px;margin-bottom:16px}
.place-short{font-size:17px;color:var(--text-mid);line-height:1.7;margin-bottom:24px}
.place-stats{display:flex;gap:24px;flex-wrap:wrap}
.place-stat{display:flex;align-items:center;gap:8px;font-family:'DM Sans',sans-serif;font-size:13px;color:var(--text-light);background:white;padding:8px 16px;border-radius:10px}
.place-stat i{color:var(--rose-deep)}

.place-content-area{display:grid;grid-template-columns:2.5fr 1fr;gap:40px;padding:40px 0}
.place-main{}
.place-sidebar{}
.sidebar-card{background:white;border-radius:16px;padding:24px;margin-bottom:20px;border:1px solid var(--border)}
.sidebar-card h4{font-family:'Playfair Display',serif;font-size:18px;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid var(--border)}
.sidebar-card a{display:flex;align-items:center;gap:12px;padding:10px 0;font-family:'DM Sans',sans-serif;font-size:14px;color:var(--text-mid);border-bottom:1px solid var(--cream-dark);transition:color .2s}
.sidebar-card a:last-child{border-bottom:none}
.sidebar-card a:hover{color:var(--rose-deep)}
.sidebar-card .s-icon{width:36px;height:36px;background:var(--cream);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}

.map-embed{width:100%;height:300px;border-radius:16px;overflow:hidden;border:1px solid var(--border);background:var(--cream-dark);display:flex;align-items:center;justify-content:center;color:var(--text-light);font-family:'DM Sans',sans-serif}

.related-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-top:24px}

@media(max-width:1024px){
.place-hero-inner{grid-template-columns:1fr}
.place-content-area{grid-template-columns:1fr}
.place-sidebar{order:-1}
}
@media(max-width:768px){
.related-grid{grid-template-columns:1fr}
.place-hero{padding:100px 0 24px}
}
</style>
{% endblock %}

{% block content %}
<section class="place-hero">
<div class="place-hero-bg"></div>
<div class="container">
<div class="breadcrumb">
<a href="{{ url_for('home') }}">Home</a> <span>‚Ä∫</span>
<a href="{{ url_for('explore') }}">Explore</a> <span>‚Ä∫</span>
<span>{{ place.title }}</span>
</div>
<div class="place-hero-inner">
<div>
<div class="place-tags">
{% for tag in tags %}
<span class="place-tag" style="background:{{ tag.color }}">{{ tag.name }}</span>
{% endfor %}
</div>
<h1 class="place-title">{{ place.title }}</h1>
<div class="place-location">
<i class="fas fa-map-marker-alt" style="color:var(--rose-deep)"></i>
{{ place.city }}{% if place.state %}, {{ place.state }}{% endif %}, {{ place.country }}
</div>
<p class="place-short">{{ place.short_description }}</p>
<div class="place-stats">
<div class="place-stat"><i class="fas fa-eye"></i> {{ place.view_count }} views</div>
{% if media|selectattr('media_role','equalto','gallery')|list|length > 0 %}
<div class="place-stat"><i class="fas fa-images"></i> {{ media|length }} photos</div>
{% endif %}
</div>
</div>
<div class="place-hero-img">
{% if place.featured_image %}
<img src="/static/uploads/{{ place.featured_image }}" alt="{{ place.title }}">
{% else %}
üõï
{% endif %}
</div>
</div>
</div>
</section>

<div class="container">
<div class="place-content-area">
<!-- Main Content -->
<div class="place-main">
<!-- Rich Content -->
<div class="rich-content">
{{ place.full_content|safe }}
</div>

<!-- Image Gallery -->
{% set gallery_media = media|selectattr('media_role','equalto','gallery')|list %}
{% if gallery_media %}
<div style="margin-top:40px">
<h2 style="font-family:'Playfair Display',serif;font-size:24px;margin-bottom:20px">üì∏ Photo Gallery</h2>
<div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px">
{% for m in gallery_media %}
<div style="border-radius:12px;overflow:hidden;aspect-ratio:4/3;background:var(--cream-dark)">
<img src="/static/uploads/{{ m.filename }}" alt="{{ m.alt_text or place.title }}" style="width:100%;height:100%;object-fit:cover">
</div>
{% endfor %}
</div>
</div>
{% endif %}

<!-- Audio -->
{% set audio_media = media|selectattr('file_type','equalto','audio')|list if media else [] %}
{% if audio_media %}
<div style="margin-top:40px">
<h2 style="font-family:'Playfair Display',serif;font-size:24px;margin-bottom:20px">üéµ Audio Narration</h2>
{% for m in audio_media %}
<div class="audio-player" style="margin-bottom:12px">
<h3 style="font-size:16px">{{ m.original_name }}</h3>
<audio controls style="width:100%;margin-top:12px">
<source src="/static/uploads/{{ m.filename }}" type="{{ m.mime_type }}">
</audio>
</div>
{% endfor %}
</div>
{% endif %}

<!-- Related Module Entries -->
{% if related_entries %}
<div style="margin-top:40px">
<h2 style="font-family:'Playfair Display',serif;font-size:24px;margin-bottom:20px">üìö Related Content</h2>
{% for entry in related_entries %}
<a href="{{ url_for('entry_detail', mod_slug=entry.module_slug, entry_slug=entry.slug) }}" style="display:flex;align-items:center;gap:16px;padding:16px;background:white;border-radius:14px;margin-bottom:10px;border:1px solid var(--border);transition:all .2s;text-decoration:none;color:var(--text-dark)">
<span style="font-size:24px">{{ entry.module_icon }}</span>
<div>
<div style="font-family:'DM Sans',sans-serif;font-size:11px;color:var(--rose-deep);font-weight:600;letter-spacing:1px;text-transform:uppercase">{{ entry.module_name }}</div>
<div style="font-family:'Playfair Display',serif;font-size:17px">{{ entry.title }}</div>
</div>
</a>
{% endfor %}
</div>
{% endif %}

<!-- Share -->
<div class="share-btns">
<span style="font-family:'DM Sans',sans-serif;font-size:13px;color:var(--text-light);margin-right:8px;align-self:center">Share:</span>
<button class="share-btn" onclick="window.open('https://twitter.com/intent/tweet?text={{ place.title }}&url='+encodeURIComponent(window.location.href))"><i class="fab fa-twitter"></i></button>
<button class="share-btn" onclick="window.open('https://www.facebook.com/sharer.php?u='+encodeURIComponent(window.location.href))"><i class="fab fa-facebook-f"></i></button>
<button class="share-btn" onclick="window.open('https://wa.me/?text={{ place.title }} '+encodeURIComponent(window.location.href))"><i class="fab fa-whatsapp"></i></button>
<button class="share-btn" onclick="navigator.clipboard.writeText(window.location.href);this.innerHTML='‚úì'"><i class="fas fa-link"></i></button>
</div>
</div>

<!-- Sidebar -->
<div class="place-sidebar">
<!-- Map -->
{% if place.latitude and place.longitude %}
<div class="sidebar-card" style="padding:0;overflow:hidden">
<div class="map-embed">
<iframe width="100%" height="300" style="border:0" loading="lazy" referrerpolicy="no-referrer-when-downgrade"
src="https://maps.google.com/maps?q={{ place.latitude }},{{ place.longitude }}&z=13&output=embed"></iframe>
</div>
</div>
{% endif %}

<!-- Nearby Places -->
{% if nearby %}
<div class="sidebar-card">
<h4>üó∫Ô∏è Nearby Sacred Sites</h4>
{% for np in nearby %}
<a href="{{ url_for('place_detail', slug=np.slug) }}">
<span class="s-icon">üõï</span>
<div>
<div style="font-weight:500;color:var(--text-dark)">{{ np.title }}</div>
<div style="font-size:12px;color:var(--text-light)">{{ np.distance_km }} km away</div>
</div>
</a>
{% endfor %}
</div>
{% endif %}

<!-- Quick Info -->
<div class="sidebar-card">
<h4>‚ÑπÔ∏è Quick Info</h4>
<div style="font-family:'DM Sans',sans-serif;font-size:14px;color:var(--text-mid)">
<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--cream-dark)">
<span>Location</span><strong>{{ place.city }}, {{ place.state }}</strong>
</div>
<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid var(--cream-dark)">
<span>Country</span><strong>{{ place.country }}</strong>
</div>
{% if place.latitude %}
<div style="display:flex;justify-content:space-between;padding:8px 0">
<span>Coordinates</span><strong style="font-size:12px">{{ "%.4f"|format(place.latitude) }}, {{ "%.4f"|format(place.longitude) }}</strong>
</div>
{% endif %}
</div>
</div>
</div>
</div>

<!-- Related Places -->
{% if related %}
<section class="section">
<div class="section-header">
<div class="section-tag">You May Also Like</div>
<h2 class="section-title">Related Holy Places</h2>
</div>
<div class="related-grid">
{% for rp in related %}
<div class="card">
<a href="{{ url_for('place_detail', slug=rp.slug) }}" class="card-img">
<div class="card-img-bg" style="background:linear-gradient(135deg,var(--cream-dark),var(--cream-deep));display:flex;align-items:center;justify-content:center;font-size:40px;height:100%">üõï</div>
</a>
<div class="card-body">
<h3 class="card-title"><a href="{{ url_for('place_detail', slug=rp.slug) }}">{{ rp.title }}</a></h3>
<div class="card-loc"><i class="fas fa-map-marker-alt"></i> {{ rp.city }}, {{ rp.state }}</div>
</div>
</div>
{% endfor %}
</div>
</section>
{% endif %}
</div>
{% endblock %}
