{% extends "frontend/base.html" %}
{% block title %}{{ ks.title }} ‚Äî {{ kp.title }} ‚Äî {{ place.title }}{% endblock %}
{% block content %}
<!-- Hero with category accent -->
{% set accent = ks.cat_color or '#E74C3C' %}
<section style="background:linear-gradient(135deg,{{ accent }}dd 0%,{{ accent }}99 60%,{{ accent }}bb 100%);padding:70px 0 50px;color:white;position:relative;overflow:hidden">
<div style="position:absolute;inset:0;background:url('/static/uploads/{{ ks.featured_image or place.featured_image }}') center/cover;opacity:.1"></div>
<div style="position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.2),rgba(0,0,0,.05))"></div>
<div class="container" style="position:relative;z-index:1">
<!-- Breadcrumb -->
<nav style="display:flex;align-items:center;gap:8px;margin-bottom:18px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;flex-wrap:wrap">
<a href="{{ url_for('place_detail', slug=place.slug) }}" style="color:rgba(255,255,255,.6);text-decoration:none">{{ place.title }}</a><span style="opacity:.4">‚Ä∫</span>
<a href="{{ url_for('key_place_detail', slug=place.slug, kp_slug=kp.slug) }}" style="color:rgba(255,255,255,.7);text-decoration:none">{{ kp.title }}</a><span style="opacity:.4">‚Ä∫</span>
<span style="opacity:.9">{{ ks.title }}</span>
</nav>
<!-- Category badge -->
<div style="display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,.15);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.2);border-radius:50px;padding:6px 16px;margin-bottom:14px">
<span style="font-size:18px">{{ ks.cat_icon or 'üìç' }}</span>
<span style="font-family:'Plus Jakarta Sans',sans-serif;font-size:12px;font-weight:600;letter-spacing:1px;text-transform:uppercase;opacity:.9">Tier 3 ¬∑ {{ ks.cat_name or 'Key Spot' }}</span>
</div>
<h1 style="font-family:'Josefin Sans',sans-serif;font-size:clamp(28px,4.5vw,48px);font-weight:700;margin-bottom:8px">{{ ks.title }}</h1>
{% if ks.short_description %}<p style="max-width:650px;font-size:15px;line-height:1.7;opacity:.8;font-family:'Nunito Sans',sans-serif">{{ ks.short_description }}</p>{% endif %}
{% if sub_spots %}<div style="display:flex;gap:16px;margin-top:18px;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;flex-wrap:wrap">
<div style="padding:10px 18px;background:rgba(255,255,255,.12);border-radius:10px"><strong>{{ sub_spots|length }}</strong> Sub-Spots within</div>
</div>{% endif %}
</div>
</section>

<!-- Content -->
<section style="padding:45px 0">
<div class="container" style="display:grid;grid-template-columns:1fr 320px;gap:40px;align-items:start">
<div>
{% if ks.featured_image %}<div style="margin-bottom:28px;border-radius:16px;overflow:hidden;box-shadow:0 4px 24px rgba(0,0,0,.08)"><img src="/static/uploads/{{ ks.featured_image }}" alt="{{ ks.title }}" style="width:100%;display:block" onerror="this.parentElement.style.display='none'"></div>{% endif %}

{% if ks.full_content %}<div class="rich-content" style="margin-bottom:36px;line-height:1.85;font-size:15.5px;color:var(--text-mid)">{{ ks.full_content|safe }}</div>{% endif %}

<!-- ‚ïê‚ïê‚ïê TIER 4: SUB-SPOTS ‚ïê‚ïê‚ïê -->
{% if sub_spots %}
<div style="margin-bottom:36px">
<h2 style="font-family:'Josefin Sans',sans-serif;font-size:24px;font-weight:700;margin-bottom:6px;display:flex;align-items:center;gap:10px">‚ú¶ Sub-Spots <span style="font-size:14px;font-weight:500;color:var(--text-light);font-family:'Plus Jakarta Sans',sans-serif">(Tier 4)</span></h2>
<p style="font-size:13px;color:var(--text-light);margin-bottom:20px;font-family:'Plus Jakarta Sans',sans-serif">Sacred points within {{ ks.title }} for deeper engagement</p>

<div style="display:grid;gap:16px">
{% for ss in sub_spots %}
<a href="{{ url_for('sub_spot_detail', slug=place.slug, kp_slug=kp.slug, ks_slug=ks.slug, ss_slug=ss.slug) }}" style="display:block;text-decoration:none;color:inherit">
<div style="background:white;border-radius:16px;padding:22px;border-left:4px solid {{ ss.cat_color or '#9C27B0' }};box-shadow:0 2px 12px rgba(0,0,0,.04);transition:all .25s;position:relative" onmouseover="this.style.transform='translateX(4px)';this.style.boxShadow='0 6px 24px {{ ss.cat_color or '#9C27B0' }}15'" onmouseout="this.style.transform='none';this.style.boxShadow='0 2px 12px rgba(0,0,0,.04)'">
  <div style="display:flex;align-items:flex-start;gap:14px">
    <span style="width:44px;height:44px;background:{{ ss.cat_color or '#9C27B0' }}12;border:1.5px solid {{ ss.cat_color or '#9C27B0' }}25;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0">{{ ss.cat_icon or 'üìç' }}</span>
    <div style="flex:1">
      <div style="font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:{{ ss.cat_color or '#9C27B0' }};font-family:'Plus Jakarta Sans',sans-serif;margin-bottom:2px">{{ ss.cat_name or 'Sub-Spot' }}</div>
      <h3 style="font-family:'Josefin Sans',sans-serif;font-size:18px;font-weight:600;color:var(--text-dark);margin-bottom:4px">{{ ss.title }}</h3>
      {% if ss.short_description %}<p style="font-size:13px;color:var(--text-light);line-height:1.5;margin:0">{{ ss.short_description }}</p>{% endif %}
    </div>
    <svg style="width:18px;height:18px;color:{{ ss.cat_color or '#9C27B0' }};flex-shrink:0;margin-top:4px;opacity:.5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z"/></svg>
  </div>
</div></a>
{% endfor %}
</div>
</div>{% endif %}
</div>

<!-- Sidebar -->
<div>
<!-- Category Info Card -->
<div style="background:white;border:2px solid {{ accent }}20;border-radius:16px;padding:22px;margin-bottom:20px">
<div style="display:flex;align-items:center;gap:12px;margin-bottom:14px">
<span style="width:48px;height:48px;background:{{ accent }}12;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:26px">{{ ks.cat_icon or 'üìç' }}</span>
<div><div style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:{{ accent }};font-family:'Plus Jakarta Sans',sans-serif">Category</div><div style="font-family:'Josefin Sans',sans-serif;font-size:18px;font-weight:600">{{ ks.cat_name or 'Key Spot' }}</div></div>
</div>
<div style="font-size:13px;color:var(--text-light);line-height:1.5;font-family:'Plus Jakarta Sans',sans-serif">Part of <strong style="color:var(--text-dark)">{{ kp.title }}</strong> in <strong style="color:var(--text-dark)">{{ place.title }}</strong></div>
</div>

{% if ks.latitude and ks.longitude %}<div style="background:white;border:2px solid var(--border);border-radius:16px;overflow:hidden;margin-bottom:20px"><iframe src="https://maps.google.com/maps?q={{ ks.latitude }},{{ ks.longitude }}&z=16&output=embed" style="width:100%;height:200px;border:0"></iframe></div>{% endif %}

<!-- Sibling Key Spots -->
{% if siblings %}
<div style="background:white;border:2px solid var(--border);border-radius:16px;padding:22px;margin-bottom:20px">
<h3 style="font-family:'Josefin Sans',sans-serif;font-size:16px;font-weight:700;margin-bottom:14px">Other Key Spots</h3>
{% for sib in siblings %}
<a href="{{ url_for('key_spot_detail', slug=place.slug, kp_slug=kp.slug, ks_slug=sib.slug) }}" style="display:flex;gap:8px;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);text-decoration:none;color:inherit;font-size:13px;transition:color .2s" onmouseover="this.style.color='{{ sib.cat_color or accent }}'" onmouseout="this.style.color='inherit'">
<span style="font-size:14px">{{ sib.cat_icon or 'üìç' }}</span><strong>{{ sib.title }}</strong></a>
{% endfor %}
</div>{% endif %}

<!-- Navigation -->
<div style="display:flex;flex-direction:column;gap:8px">
<a href="{{ url_for('key_place_detail', slug=place.slug, kp_slug=kp.slug) }}" style="display:flex;align-items:center;justify-content:center;gap:8px;padding:12px;background:var(--cream-dark);color:var(--text-dark);border-radius:10px;text-decoration:none;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:600">‚Üê {{ kp.title }}</a>
<a href="{{ url_for('place_detail', slug=place.slug) }}" style="display:flex;align-items:center;justify-content:center;gap:8px;padding:12px;background:var(--rose-deep);color:white;border-radius:10px;text-decoration:none;font-family:'Plus Jakarta Sans',sans-serif;font-size:13px;font-weight:600">üôè {{ place.title }}</a>
</div>
</div>
</div>
</section>
<style>
@media(max-width:900px){section .container{grid-template-columns:1fr!important}}
.rich-content h2{font-family:'Josefin Sans',sans-serif;font-size:22px;margin:20px 0 10px;color:var(--text-dark);font-weight:700}
.rich-content h3{font-family:'Josefin Sans',sans-serif;font-size:18px;margin:16px 0 8px;font-weight:600}
.rich-content p{margin-bottom:12px}
</style>
{% endblock %}
