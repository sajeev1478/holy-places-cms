{% extends "admin/base.html" %}
{% block title %}Modules{% endblock %}
{% block page_title %}Content Modules{% endblock %}

{% block admin_content %}
<style>
.mod-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;margin-top:16px}
.mod-card{background:white;border:1px solid var(--border);border-radius:14px;padding:20px;transition:all .2s;position:relative}
.mod-card:hover{box-shadow:0 4px 20px rgba(0,0,0,.08);transform:translateY(-1px)}
.mod-header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.mod-icon{font-size:32px}
.mod-name{font-size:16px;font-weight:700;margin:0}
.mod-desc{font-size:13px;color:var(--text-light);margin-bottom:12px;line-height:1.5}
.mod-stats{display:flex;gap:16px;font-size:12px;color:var(--text-light);margin-bottom:12px;padding:8px 0;border-top:1px solid var(--border)}
.mod-stats span{display:flex;align-items:center;gap:4px}
.mod-stats i{color:var(--primary)}
.mod-fields{font-size:11px;color:var(--text-light);margin-bottom:12px}
.mod-fields .field-tag{display:inline-block;background:var(--bg-cream);padding:2px 8px;border-radius:50px;margin:2px;font-size:10px}
.mod-actions{display:flex;gap:6px;flex-wrap:wrap}
.mod-badge-active{position:absolute;top:12px;right:12px;font-size:10px;font-weight:600;padding:2px 8px;border-radius:50px}
.mod-badge-active.active{background:#d4edda;color:#155724}
.mod-badge-active.inactive{background:#f8d7da;color:#721c24}
</style>

<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
<p style="color:var(--text-light);font-size:13px;margin:0">Manage content modules and their field schemas. Each module defines a type of content with structured fields.</p>
<a href="{{ url_for('admin_module_new') }}" class="btn btn-primary btn-sm"><i class="fas fa-plus"></i> New Module</a>
</div>

<div class="mod-grid">
{% for mod in modules %}
{% set schema = [] %}
{% if mod.fields_schema %}{% set schema = mod.fields_schema|string %}{% endif %}
<div class="mod-card">
<span class="mod-badge-active {{ 'active' if mod.is_active else 'inactive' }}">{{ 'Active' if mod.is_active else 'Inactive' }}</span>
<div class="mod-header">
<div class="mod-icon">{{ mod.icon }}</div>
<div>
<h3 class="mod-name">{{ mod.name }}</h3>
{% if mod.creator_name %}<div style="font-size:11px;color:var(--text-light)">by {{ mod.creator_name }}</div>{% endif %}
</div>
</div>
<div class="mod-desc">{{ mod.description or 'No description' }}</div>
<div class="mod-stats">
<span><i class="fas fa-file-alt"></i> {{ mod.entry_count }} entries</span>
<span><i class="fas fa-layer-group"></i> {{ (mod.fields_schema|default('[]',true)|safe|length > 4) | int }} schema fields</span>
<span><i class="fas fa-sort"></i> Order: {{ mod.sort_order }}</span>
</div>
<div class="mod-actions">
<a href="{{ url_for('admin_entries', mod_id=mod.id) }}" class="btn btn-sm btn-secondary"><i class="fas fa-list"></i> Entries</a>
<a href="{{ url_for('admin_entry_new') }}?module_id={{ mod.id }}" class="btn btn-sm btn-primary"><i class="fas fa-plus"></i> Add Entry</a>
<a href="{{ url_for('admin_module_edit', mod_id=mod.id) }}" class="btn btn-sm btn-secondary btn-icon"><i class="fas fa-cog"></i></a>
</div>
</div>
{% endfor %}
</div>
{% endblock %}
