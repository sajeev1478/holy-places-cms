{% extends "admin/base.html" %}
{% block title %}Dashboard{% endblock %}
{% block page_title %}Dashboard{% endblock %}
{% block topbar_actions %}<a href="{{ url_for('admin_place_new') }}" class="btn btn-primary"><i class="fas fa-plus"></i> New Holy Dham</a>{% endblock %}

{% block admin_content %}
<!-- Help Accordion: Tier Structure -->
<div class="help-accordion">
<div class="help-accordion-toggle" onclick="toggleHelpAccordion(this)">
<span style="font-size:18px">ğŸ›ï¸</span>
<h4>Understanding the 4-Tier Dham Hierarchy</h4>
<svg class="ha-chevron" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"/></svg>
</div>
<div class="help-accordion-body"><div class="help-accordion-inner">
<p>The HolyDham CMS uses a <strong>4-tier hierarchy</strong> to organize spiritual destinations â€” from an entire holy region down to the exact spot where a divine pastime took place.</p>
<div class="ha-tier-flow">
<div class="ha-tier-box" style="background:#C76B8F">ğŸ›ï¸ T1 Holy Dham</div><span class="ha-tier-arrow">â†’</span>
<div class="ha-tier-box" style="background:#2E86AB">ğŸ“ T2 Key Places</div><span class="ha-tier-arrow">â†’</span>
<div class="ha-tier-box" style="background:#E74845">ğŸ¯ T3 Key Spots</div><span class="ha-tier-arrow">â†’</span>
<div class="ha-tier-box" style="background:#9C27B0">âœ¦ T4 Key Points</div>
</div>
<h5>Tier 1 â€” Holy Dham</h5>
<p>The broadest level â€” an entire holy region or city (e.g., <strong>Vrindavan Dham</strong>, <strong>Mayapur Dham</strong>).</p>
<h5>Tier 2 â€” Key Places</h5>
<p>Major zones or important locations within a Holy Dham (e.g., <strong>Vrindavan Town</strong>, <strong>Govardhan</strong>, <strong>Barsana</strong> within Vrindavan Dham).</p>
<h5>Tier 3 â€” Key Spots</h5>
<p>Specific temples, ghats, or sacred areas within a Key Place (e.g., <strong>Banke Bihari Temple</strong>, <strong>Kesi Ghat</strong>).</p>
<h5>Tier 4 â€” Key Points</h5>
<p>Exact micro-locations or meditation points within a Key Spot (e.g., <strong>Jhulan Sthal</strong>, <strong>Swami Haridas Samadhi</strong>).</p>
<div class="ha-tip">ğŸ’¡ <strong>Tip:</strong> Always create content top-down â€” first T1, then add T2 Key Places within it, then T3, then T4. This builds a complete spiritual map!</div>
</div></div>
</div>

<!-- 4-Tier Hierarchy Stats -->
<div style="background:linear-gradient(135deg,#2D1F2E,#4A2D4E);border-radius:16px;padding:24px 28px;margin-bottom:24px;color:white;position:relative;overflow:hidden">
<div style="position:absolute;right:-30px;top:-20px;font-size:120px;opacity:.04;pointer-events:none">ğŸ›•</div>
<h3 style="font-size:13px;font-weight:700;letter-spacing:2px;text-transform:uppercase;opacity:.6;margin-bottom:16px;font-family:'Plus Jakarta Sans',sans-serif">4-Tier Dham Hierarchy</h3>
<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:16px">
<div style="background:rgba(255,255,255,.08);border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,.08)">
<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><span style="width:28px;height:28px;background:rgba(199,107,143,.3);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px">ğŸ™</span><span style="font-size:10px;letter-spacing:1.5px;text-transform:uppercase;opacity:.6;font-family:'Plus Jakarta Sans',sans-serif">Tier 1</span></div>
<div style="font-size:28px;font-weight:700;font-family:'Josefin Sans',sans-serif">{{ stats.places }}</div>
<div style="font-size:12px;opacity:.6">Holy Dhams</div>
</div>
<div style="background:rgba(255,255,255,.08);border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,.08)">
<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><span style="width:28px;height:28px;background:rgba(46,134,171,.3);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px">ğŸ“</span><span style="font-size:10px;letter-spacing:1.5px;text-transform:uppercase;opacity:.6;font-family:'Plus Jakarta Sans',sans-serif">Tier 2</span></div>
<div style="font-size:28px;font-weight:700;font-family:'Josefin Sans',sans-serif">{{ stats.key_places }}</div>
<div style="font-size:12px;opacity:.6">Key Places</div>
</div>
<div style="background:rgba(255,255,255,.08);border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,.08)">
<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><span style="width:28px;height:28px;background:rgba(231,72,69,.3);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px">ğŸ”¸</span><span style="font-size:10px;letter-spacing:1.5px;text-transform:uppercase;opacity:.6;font-family:'Plus Jakarta Sans',sans-serif">Tier 3</span></div>
<div style="font-size:28px;font-weight:700;font-family:'Josefin Sans',sans-serif">{{ stats.key_spots }}</div>
<div style="font-size:12px;opacity:.6">Key Spots</div>
</div>
<div style="background:rgba(255,255,255,.08);border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,.08)">
<div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><span style="width:28px;height:28px;background:rgba(156,39,176,.3);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px">âœ¦</span><span style="font-size:10px;letter-spacing:1.5px;text-transform:uppercase;opacity:.6;font-family:'Plus Jakarta Sans',sans-serif">Tier 4</span></div>
<div style="font-size:28px;font-weight:700;font-family:'Josefin Sans',sans-serif">{{ stats.sub_spots }}</div>
<div style="font-size:12px;opacity:.6">Key Points</div>
</div>
</div>
</div>

<div class="stats-grid">
<div class="stat-card"><div class="stat-icon green"><i class="fas fa-check-circle"></i></div><div><div class="stat-num">{{ stats.published }}</div><div class="stat-label">Published Dhams</div></div></div>
<div class="stat-card"><div class="stat-icon amber"><i class="fas fa-file-alt"></i></div><div><div class="stat-num">{{ stats.entries }}</div><div class="stat-label">Module Entries</div></div></div>
<div class="stat-card"><div class="stat-icon blue"><i class="fas fa-photo-video"></i></div><div><div class="stat-num">{{ stats.media }}</div><div class="stat-label">Media Files</div></div></div>
<div class="stat-card"><div class="stat-icon rose"><i class="fas fa-cubes"></i></div><div><div class="stat-num">{{ stats.modules }}</div><div class="stat-label">Active Modules</div></div></div>
<div class="stat-card"><div class="stat-icon green"><i class="fas fa-users"></i></div><div><div class="stat-num">{{ stats.users }}</div><div class="stat-label">Users</div></div></div>
</div>

<div style="display:grid;grid-template-columns:1.5fr 1fr;gap:20px">
<!-- Recent Dhams -->
<div class="admin-card">
<div class="admin-card-header"><h3>Recent Holy Dhams</h3><a href="{{ url_for('admin_places') }}" class="btn btn-secondary btn-sm">View All</a></div>
<div style="overflow-x:auto">
<table class="admin-table">
<thead><tr><th>ID</th><th>Dham Name</th><th>Status</th><th>Views</th><th>Updated</th></tr></thead>
<tbody>
{% for place in recent_places %}
<tr>
<td><span class="hid-badge" onclick="copyHid(this)" data-hid="{{ place.hierarchy_id or 'â€”' }}" style="font-size:10px">{{ place.hierarchy_id or 'â€”' }} <span class="hid-copy">ğŸ“‹</span></span></td>
<td><a href="{{ url_for('admin_place_edit', place_id=place.id) }}" style="font-weight:500;color:var(--text)">{{ place.title }}</a></td>
<td><span class="badge badge-{{ place.status }}">{{ place.status }}</span></td>
<td>{{ place.view_count }}</td>
<td style="font-size:12px;color:var(--text-light)">{{ place.updated_at[:10] if place.updated_at else '' }}</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>

<!-- Active Modules -->
<div class="admin-card">
<div class="admin-card-header"><h3>Modules</h3><a href="{{ url_for('admin_module_new') }}" class="btn btn-secondary btn-sm"><i class="fas fa-plus"></i> New</a></div>
<div class="admin-card-body" style="padding:12px">
{% for mod in modules %}
<a href="{{ url_for('admin_entries', mod_id=mod.id) }}" style="display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;color:var(--text);text-decoration:none;transition:background .2s;{% if not mod.is_active %}opacity:.5{% endif %}">
<span style="font-size:24px">{{ mod.icon }}</span>
<div style="flex:1">
<div style="font-weight:600;font-size:14px">{{ mod.name }}</div>
<div style="font-size:12px;color:var(--text-light)">{{ mod.entry_count }} entries</div>
</div>
<span style="font-size:12px;color:var(--text-light)"><i class="fas fa-chevron-right"></i></span>
</a>
{% endfor %}
</div>
</div>
</div>

<!-- Recent Activity -->
<div class="admin-card" style="margin-top:20px">
<div class="admin-card-header"><h3>Recent Activity</h3></div>
<div style="overflow-x:auto">
<table class="admin-table">
<thead><tr><th>User</th><th>Action</th><th>Details</th><th>Time</th></tr></thead>
<tbody>
{% for log in recent_log %}
<tr>
<td style="font-weight:500">{{ log.display_name or 'System' }}</td>
<td><span class="badge" style="background:var(--primary-light);color:var(--primary)">{{ log.action|replace('_',' ') }}</span></td>
<td style="font-size:13px;color:var(--text-light)">{{ log.details or '' }}</td>
<td style="font-size:12px;color:var(--text-light)">{{ log.created_at[:16] if log.created_at else '' }}</td>
</tr>
{% endfor %}
{% if not recent_log %}<tr><td colspan="4" style="text-align:center;color:var(--text-light);padding:24px">No activity yet</td></tr>{% endif %}
</tbody>
</table>
</div>
</div>
{% endblock %}
