{% extends "admin/base.html" %}
{% block title %}Key Points (Tier 4) â€” {{ ks.title }}{% endblock %}
{% block page_title %}
<div style="display:flex;align-items:center;gap:12px">
<span style="width:36px;height:36px;background:#9C27B015;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px">âœ¦</span>
<div>
<div style="font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:#9C27B0">Tier 4 Â· Key Points</div>
<div>{{ ks.title }}</div>
</div>
</div>
{% endblock %}
{% block topbar_actions %}
<a href="{{ url_for('admin_key_place_spots', kp_id=ks.kp_id) }}" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Back to Key Spots</a>
{% endblock %}

{% block admin_content %}
<!-- Breadcrumb -->
<div style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:20px;font-size:13px">
<a href="{{ url_for('admin_places') }}" style="display:flex;align-items:center;gap:4px;text-decoration:none;color:var(--text-light)"><span style="width:18px;height:18px;background:#C76B8F;color:white;border-radius:5px;display:inline-flex;align-items:center;justify-content:center;font-size:8px;font-weight:700">T1</span> {{ ks.dham_title }}</a>
<span style="color:var(--text-light)">â€º</span>
<a href="{{ url_for('admin_place_edit', place_id=ks.dham_id) }}" style="display:flex;align-items:center;gap:4px;text-decoration:none;color:#2E86AB"><span style="width:18px;height:18px;background:#2E86AB;color:white;border-radius:5px;display:inline-flex;align-items:center;justify-content:center;font-size:8px;font-weight:700">T2</span> {{ ks.kp_title }}</a>
<span style="color:var(--text-light)">â€º</span>
<a href="{{ url_for('admin_key_place_spots', kp_id=ks.kp_id) }}" style="display:flex;align-items:center;gap:4px;text-decoration:none;color:#E74845"><span style="width:18px;height:18px;background:#E74845;color:white;border-radius:5px;display:inline-flex;align-items:center;justify-content:center;font-size:8px;font-weight:700">T3</span> {{ ks.title }}</a>
<span style="color:var(--text-light)">â€º</span>
<span style="display:flex;align-items:center;gap:4px;color:#9C27B0;font-weight:700"><span style="width:18px;height:18px;background:#9C27B0;color:white;border-radius:5px;display:inline-flex;align-items:center;justify-content:center;font-size:8px;font-weight:700">T4</span> Key Points</span>
</div>

<!-- Tier Info -->
<div style="background:linear-gradient(135deg,#faf5fc,#f3ecf8);border:1.5px solid #9C27B020;border-radius:14px;padding:18px 22px;margin-bottom:20px;display:flex;align-items:center;gap:16px;flex-wrap:wrap">
<span style="width:44px;height:44px;background:#9C27B015;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0">âœ¦</span>
<div style="flex:1;min-width:200px">
<div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
<span style="font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;padding:3px 10px;background:#9C27B0;color:white;border-radius:50px">Tier 4</span>
<span style="font-size:14px;font-weight:700;color:#9C27B0">Key Points</span>
</div>
<div style="font-size:13px;color:var(--text-mid)">Micro-locations within <strong>{{ ks.title }}</strong>. Each has <strong>all fields</strong>: location, description, gallery, custom fields.</div>
</div>
<div style="text-align:center;padding:8px 16px;background:white;border-radius:10px;border:1px solid var(--border)">
<div style="font-size:24px;font-weight:700;color:#9C27B0">{{ subs|length }}</div>
<div style="font-size:11px;color:var(--text-light)">Key Points</div>
</div>
</div>

<form method="POST" action="{{ url_for('admin_sub_spots_save', ks_id=ks.id) }}" enctype="multipart/form-data">
<div id="subs-container">
{% for sub in subs %}
{% set si = loop.index0 %}
{% set scv = ss_customs.get(sub.id, {}) %}
<div class="ss-item admin-card" style="margin-bottom:16px;border-left:4px solid {{ sub.cat_color or '#9C27B0' }}" data-index="{{ si }}">
<input type="hidden" name="ss_{{ si }}_id" value="{{ sub.id }}">
<div class="admin-card-header" style="cursor:pointer;user-select:none" onclick="this.parentElement.classList.toggle('ss-collapsed')">
<div style="display:flex;align-items:center;gap:10px">
<span style="font-size:18px">{{ sub.cat_icon or 'âœ¦' }}</span>
<span style="font-size:9px;font-weight:700;letter-spacing:1px;text-transform:uppercase;padding:3px 8px;background:#9C27B010;color:#9C27B0;border-radius:50px;border:1px solid #9C27B020">Tier 4</span>
<h3 class="ss-title-display" style="margin:0">{{ sub.title }}</h3>
<span class="badge" style="background:{{ sub.cat_color or '#9C27B0' }}15;color:{{ sub.cat_color or '#9C27B0' }};font-size:11px;border:1px solid {{ sub.cat_color or '#9C27B0' }}25">{{ sub.cat_name or 'No Category' }}</span>
</div>
<i class="fas fa-chevron-down ss-chevron" style="transition:transform .3s;color:var(--text-light)"></i>
</div>
<div class="ss-body" style="padding:20px">

<!-- Core -->
<div style="margin-bottom:14px;padding-bottom:12px;border-bottom:1px solid var(--border)">
<div style="font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#9C27B0;margin-bottom:10px">ğŸ“Œ Core Identity</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
<div class="form-group"><label>ğŸ“ Title *</label><input type="text" class="form-control" name="ss_{{ si }}_title" value="{{ sub.title }}" required></div>
<div class="form-group"><label>ğŸ·ï¸ Category</label><select class="form-control" name="ss_{{ si }}_category"><option value="">â€” Select â€”</option>{% for cat in sub_spot_categories %}<option value="{{ cat.id }}" {{ 'selected' if sub.category_id == cat.id }}>{{ cat.icon }} {{ cat.name }}</option>{% endfor %}</select></div>
</div>
<div class="form-group"><label>ğŸ“‹ Short Description</label><textarea class="form-control" name="ss_{{ si }}_short_description" rows="2">{{ sub.short_description or '' }}</textarea></div>
<div class="form-group"><label>ğŸ“– Full Content</label><textarea class="form-control" name="ss_{{ si }}_full_content" rows="4">{{ sub.full_content or '' }}</textarea></div>
</div>

<!-- Location -->
<div style="margin-bottom:14px;padding-bottom:12px;border-bottom:1px solid var(--border)">
<div style="font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#9C27B0;margin-bottom:10px">ğŸ“ Location</div>
<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px">
<div class="form-group"><label>ğŸ™ï¸ City</label><input type="text" class="form-control" name="ss_{{ si }}_city" value="{{ sub.city or '' }}" placeholder="e.g. Vrindavan"></div>
<div class="form-group"><label>ğŸ—ºï¸ State</label><input type="text" class="form-control" name="ss_{{ si }}_state" value="{{ sub.state or '' }}" placeholder="e.g. UP"></div>
<div class="form-group"><label>ğŸŒ Country</label><input type="text" class="form-control" name="ss_{{ si }}_country" value="{{ sub.country or '' }}" placeholder="India"></div>
</div>
<div id="loc_ss_{{ si }}" class="loc-picker">
<div class="loc-picker-title"><i class="fas fa-map-marker-alt" style="color:#9C27B0"></i> Location Picker <span class="loc-badge" style="background:#9C27B0">T4</span></div>
<div class="loc-saved" style="margin-bottom:10px"><span style="font-size:12px;color:var(--text-light);margin-right:4px">ğŸ“ Current:</span><span class="loc-saved-info">{% if sub.latitude and sub.longitude %}<span class="loc-coords-display">{{ sub.latitude }}, {{ sub.longitude }}</span>{% else %}<span class="loc-no-data">No location set</span>{% endif %}</span></div>
<div class="loc-status"></div>
<div class="loc-map-container"><div class="loc-map-wrap" style="height:100%"></div></div>
<div style="position:relative"><div class="loc-search-bar"><input class="loc-search-input" placeholder="ğŸ” Search for {{ sub.title or 'this point' }}"><button class="loc-search-btn" type="button"><i class="fas fa-search"></i> Search</button></div><div class="loc-search-results"></div></div>
<div class="loc-actions-row"><button type="button" class="loc-btn loc-btn-gps">ğŸ“¡ Use My Current Location</button><button type="button" class="loc-btn loc-btn-clear">ğŸ—‘ï¸ Clear</button></div>
<div class="loc-coords-row">
<div class="form-group"><label>ğŸ“ Latitude</label><input type="number" class="form-control" name="ss_{{ si }}_latitude" value="{{ sub.latitude or '' }}" step="any"></div>
<div class="form-group"><label>ğŸ“ Longitude</label><input type="number" class="form-control" name="ss_{{ si }}_longitude" value="{{ sub.longitude or '' }}" step="any"></div>
</div>
<div style="font-size:10px;color:var(--text-light);margin-top:6px;display:flex;align-items:center;gap:6px"><i class="fas fa-info-circle"></i> Click map Â· Drag pin Â· GPS/Search</div>
</div>
</div>

<!-- Images -->
<div style="margin-bottom:14px;padding-bottom:12px;border-bottom:1px solid var(--border)">
<div style="font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#9C27B0;margin-bottom:10px">ğŸ–¼ï¸ Images & Gallery</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:14px">
<div class="form-group"><label>ğŸ–¼ï¸ Featured Image</label>
{% if sub.featured_image %}<input type="hidden" name="ss_{{ si }}_featured_image_existing" value="{{ sub.featured_image }}">
<div class="gal-section" style="margin-bottom:6px"><div class="gal-thumbs"><div class="gal-thumb"><img src="/static/uploads/{{ sub.featured_image }}" onclick="openLightbox(this.src)" onerror="this.parentElement.style.display='none'"><span class="gal-del" onclick="deleteGalleryImage('t4',{{ sub.id }},'{{ sub.featured_image }}',this)" title="Delete">âœ•</span></div></div></div>{% endif %}
<input type="file" class="form-control" name="ss_{{ si }}_featured_image_file" accept="image/*"></div>
<div class="form-group gal-section"><label>ğŸ“¸ Gallery Images
{% if sub.gallery_images %}<span class="gal-count">{{ sub.gallery_images.split(',')|length }} image{{ 's' if sub.gallery_images.split(',')|length != 1 }}</span>{% endif %}</label>
<input type="hidden" name="ss_{{ si }}_gallery_existing" value="{{ sub.gallery_images or '' }}" class="gal-existing-input">
<input type="hidden" class="gal-captions-data" data-prefix="ss_{{ si }}" value="{{ sub.gallery_captions|default('{}') }}">
{% if sub.gallery_images %}
<div class="gal-individual-list" id="ss_{{ si }}_gal_list">
{% for gi in sub.gallery_images.split(',') %}{% if gi.strip() %}
<div class="gal-item" style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg-cream);border:1px solid var(--border);border-radius:10px;margin-bottom:8px">
<div class="gal-thumb" style="flex-shrink:0"><img src="/static/uploads/{{ gi.strip() }}" style="width:70px;height:70px;object-fit:cover;border-radius:8px;cursor:pointer" onclick="openLightbox(this.src)" onerror="this.parentElement.style.display='none'"></div>
<div style="flex:1;min-width:0">
<input type="text" class="form-control gal-caption-input" name="ss_{{ si }}_caption_{{ gi.strip() }}" data-img="{{ gi.strip() }}" placeholder="Caption for this image..." style="font-size:12px">
<div style="font-size:10px;color:var(--text-light);margin-top:3px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">{{ gi.strip().split('/')[-1] }}</div>
</div>
<button type="button" class="btn btn-danger btn-sm btn-icon" style="flex-shrink:0" onclick="galDeleteConfirm(this,'t4',{{ sub.id }},'{{ gi.strip() }}','ss_{{ si }}')"><i class="fas fa-trash"></i></button>
</div>
{% endif %}{% endfor %}
</div>
{% endif %}
<div id="ss_{{ si }}_new_gals"></div>
<button type="button" class="btn btn-sm btn-secondary" style="margin-top:6px;font-size:11px" onclick="addGalleryItem('ss_{{ si }}')"><i class="fas fa-plus"></i> Add More Images</button>
</div>
<div style="font-size:10px;color:var(--text-light);margin-top:3px">Ctrl/Cmd+click for multiple. Appends to existing.</div></div>
</div>
</div>

<!-- Custom Fields -->
{% if custom_fields %}
<div style="margin-bottom:10px">
<div style="font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#9C27B0;margin-bottom:10px">âš™ï¸ Custom Fields</div>
<div style="display:grid;gap:8px">
{% for cf in custom_fields %}{% if cf.name != 'entry_fee' and cf.name != 'gallery_images' %}
{% set cv = scv.get(cf.id, {}) %}
<div style="display:flex;gap:8px;align-items:start;background:var(--cream-dark);border-radius:10px;padding:10px 12px;border:1px solid var(--border)">
<div style="flex:1">
<label style="display:flex;align-items:center;gap:6px;font-size:13px;font-weight:600;margin-bottom:5px"><span style="font-size:15px">{{ cf.icon or 'ğŸ“‹' }}</span> {{ cf.label }}</label>
{% if cf.field_type in ('text','url','number') %}<input name="ss_{{ si }}_cf_{{ cf.id }}" class="form-control" value="{{ cv.get('value','') }}" placeholder="{{ cf.placeholder }}" style="font-size:13px">
{% elif cf.field_type in ('textarea','richtext') %}<textarea name="ss_{{ si }}_cf_{{ cf.id }}" class="form-control" rows="2" style="font-size:13px">{{ cv.get('value','') }}</textarea>
{% elif cf.field_type in ('image','audio','video') %}{% if cv.get('value') %}<input type="hidden" name="ss_{{ si }}_cf_{{ cf.id }}" value="{{ cv.get('value','') }}">
{% if cf.field_type=='image' %}<div class="gal-section" style="margin-bottom:4px"><div class="gal-thumbs"><div class="gal-thumb"><img src="/static/uploads/{{ cv.get('value','') }}" onclick="openLightbox(this.src)" onerror="this.parentElement.style.display='none'"><span class="gal-del" onclick="cfDeleteImage(this,'ss_{{ si }}_cf_{{ cf.id }}','{{ cv.get('value','') }}')" title="Delete">âœ•</span></div></div></div>
{% else %}<div style="font-size:10px;color:green;margin-bottom:3px">âœ… {{ cv.get('value','') }}</div>{% endif %}{% endif %}<input type="file" name="ss_{{ si }}_cf_file_{{ cf.id }}" class="form-control" style="font-size:13px">
{% elif cf.field_type == 'images' %}{% if cv.get('value') %}<input type="hidden" name="ss_{{ si }}_cf_{{ cf.id }}" value="{{ cv.get('value','') }}">
<div class="gal-section" style="margin-bottom:4px"><span class="gal-count">{{ cv.get('value','').split(',')|reject('equalto','')|list|length }} image{{ 's' if cv.get('value','').split(',')|reject('equalto','')|list|length != 1 else '' }} already uploaded</span>
<div class="gal-thumbs">{% for gi in cv.get('value','').split(',') %}{% if gi.strip() %}<div class="gal-thumb"><img src="/static/uploads/{{ gi.strip() }}" onclick="openLightbox(this.src)" onerror="this.parentElement.style.display='none'"><span class="gal-del" onclick="cfDeleteImage(this,'ss_{{ si }}_cf_{{ cf.id }}','{{ gi.strip() }}')" title="Delete image">âœ•</span></div>{% endif %}{% endfor %}</div></div>{% endif %}<input type="file" name="ss_{{ si }}_cf_files_{{ cf.id }}" class="form-control" accept="image/*" multiple style="font-size:13px">
{% else %}<input name="ss_{{ si }}_cf_{{ cf.id }}" class="form-control" value="{{ cv.get('value','') }}" style="font-size:13px">{% endif %}
</div>
<div style="padding-top:26px"><label style="font-size:11px;cursor:pointer"><input type="checkbox" name="ss_{{ si }}_cf_vis_{{ cf.id }}" {{ 'checked' if cv.get('is_visible',1) }} style="accent-color:#27AE60"> Show</label></div>
</div>
{% endif %}{% endfor %}
</div></div>
{% endif %}

<!-- Controls -->
<div style="display:flex;gap:10px;margin-top:10px;align-items:center">
<label style="display:flex;align-items:center;gap:4px;font-size:12px;cursor:pointer"><input type="checkbox" name="ss_{{ si }}_is_visible" {{ 'checked' if sub.is_visible }}> Visible</label>
<button type="button" class="btn btn-sm" style="background:#e74c3c15;color:#e74c3c;border:1px solid #e74c3c30;margin-left:auto" onclick="this.closest('.ss-item').remove()"><i class="fas fa-trash"></i></button>
</div>
</div></div>
{% endfor %}
</div>

<div style="display:flex;gap:12px;margin-top:20px">
<button type="button" class="btn btn-secondary" id="addSubBtn" style="border-color:#9C27B040;color:#9C27B0"><i class="fas fa-plus"></i> Add Key Point</button>
<button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save All</button>
</div>
</form>

<style>.ss-item.ss-collapsed .ss-body{display:none}.ss-item.ss-collapsed .ss-chevron{transform:rotate(-90deg)}</style>
<script>
let subIdx={{ subs|length }};
document.getElementById('addSubBtn').addEventListener('click',function(){
const c=document.getElementById('subs-container');
const cfHtml=`{% for cf in custom_fields %}{% if cf.name!='entry_fee' and cf.name!='gallery_images' %}<div style="display:flex;gap:8px;align-items:start;background:var(--cream-dark);border-radius:10px;padding:10px 12px;border:1px solid var(--border)"><div style="flex:1"><label style="display:flex;align-items:center;gap:6px;font-size:13px;font-weight:600;margin-bottom:5px"><span style="font-size:15px">{{ cf.icon or 'ğŸ“‹' }}</span> {{ cf.label }}</label>{% if cf.field_type in ('text','url','number') %}<input name="ss_${subIdx}_cf_{{ cf.id }}" class="form-control" placeholder="{{ cf.placeholder }}" style="font-size:13px">{% elif cf.field_type in ('textarea','richtext') %}<textarea name="ss_${subIdx}_cf_{{ cf.id }}" class="form-control" rows="2" style="font-size:13px"></textarea>{% elif cf.field_type in ('image','audio','video') %}<input type="file" name="ss_${subIdx}_cf_file_{{ cf.id }}" class="form-control" style="font-size:13px">{% elif cf.field_type=='images' %}<input type="file" name="ss_${subIdx}_cf_files_{{ cf.id }}" class="form-control" accept="image/*" multiple style="font-size:13px">{% else %}<input name="ss_${subIdx}_cf_{{ cf.id }}" class="form-control" style="font-size:13px">{% endif %}</div><div style="padding-top:26px"><label style="font-size:11px;cursor:pointer"><input type="checkbox" name="ss_${subIdx}_cf_vis_{{ cf.id }}" checked style="accent-color:#27AE60"> Show</label></div></div>{% endif %}{% endfor %}`;
c.insertAdjacentHTML('beforeend',`<div class="ss-item admin-card" style="margin-bottom:16px;border-left:4px solid #9C27B0" data-index="${subIdx}"><div class="admin-card-header" onclick="this.parentElement.classList.toggle('ss-collapsed')" style="cursor:pointer;user-select:none"><div style="display:flex;align-items:center;gap:10px"><span style="font-size:18px">âœ¦</span><span style="font-size:9px;font-weight:700;padding:3px 8px;background:#9C27B010;color:#9C27B0;border-radius:50px;border:1px solid #9C27B020;letter-spacing:1px;text-transform:uppercase">T4</span><h3>New Key Point</h3></div><i class="fas fa-chevron-down ss-chevron" style="transition:transform .3s;color:var(--text-light)"></i></div><div class="ss-body" style="padding:20px"><div style="margin-bottom:14px;padding-bottom:12px;border-bottom:1px solid var(--border)"><div style="font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#9C27B0;margin-bottom:10px">ğŸ“Œ Core</div><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px"><div class="form-group"><label>ğŸ“ Title *</label><input type="text" class="form-control" name="ss_${subIdx}_title" required></div><div class="form-group"><label>ğŸ·ï¸ Category</label><select class="form-control" name="ss_${subIdx}_category"><option value="">â€” Select â€”</option>{% for cat in sub_spot_categories %}<option value="{{ cat.id }}">{{ cat.icon }} {{ cat.name }}</option>{% endfor %}</select></div></div><div class="form-group"><label>ğŸ“‹ Description</label><textarea class="form-control" name="ss_${subIdx}_short_description" rows="2"></textarea></div><div class="form-group"><label>ğŸ“– Content</label><textarea class="form-control" name="ss_${subIdx}_full_content" rows="4"></textarea></div></div><div style="margin-bottom:14px;padding-bottom:12px;border-bottom:1px solid var(--border)"><div style="font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#9C27B0;margin-bottom:10px">ğŸ“ Location</div><div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px"><div class="form-group"><label>ğŸ™ï¸ City</label><input type="text" class="form-control" name="ss_${subIdx}_city"></div><div class="form-group"><label>ğŸ—ºï¸ State</label><input type="text" class="form-control" name="ss_${subIdx}_state"></div><div class="form-group"><label>ğŸŒ Country</label><input type="text" class="form-control" name="ss_${subIdx}_country"></div></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px"><div class="form-group"><label>ğŸ“ Lat</label><input type="number" class="form-control" name="ss_${subIdx}_latitude" step="any"></div><div class="form-group"><label>ğŸ“ Lng</label><input type="number" class="form-control" name="ss_${subIdx}_longitude" step="any"></div></div></div><div style="margin-bottom:14px;padding-bottom:12px;border-bottom:1px solid var(--border)"><div style="font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#9C27B0;margin-bottom:10px">ğŸ–¼ï¸ Images</div><div style="display:grid;grid-template-columns:1fr 1fr;gap:14px"><div class="form-group"><label>ğŸ–¼ï¸ Featured</label><input type="file" class="form-control" name="ss_${subIdx}_featured_image_file" accept="image/*"></div><div class="form-group"><label>ğŸ“¸ Gallery</label><div id="ss_${subIdx}_new_gals"></div><button type="button" class="btn btn-sm btn-secondary" style="margin-top:6px;font-size:11px" onclick="addGalleryItem('ss_${subIdx}')"><i class="fas fa-plus"></i> Add More Images</button></div></div></div><div style="margin-bottom:10px"><div style="font-size:11px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#9C27B0;margin-bottom:10px">âš™ï¸ Custom Fields</div><div style="display:grid;gap:8px">${cfHtml}</div></div><div style="display:flex;gap:10px;align-items:center"><label style="font-size:12px;cursor:pointer"><input type="checkbox" name="ss_${subIdx}_is_visible" checked> Visible</label><button type="button" class="btn btn-sm" style="background:#e74c3c15;color:#e74c3c;border:1px solid #e74c3c30;margin-left:auto" onclick="this.closest('.ss-item').remove()"><i class="fas fa-trash"></i></button></div></div></div>`);
subIdx++;
});

// Initialize Location Pickers for existing T4 points
document.addEventListener('DOMContentLoaded', function(){
  {% for sub in subs %}
  initLocationPicker('loc_ss_{{ loop.index0 }}','ss_{{ loop.index0 }}_latitude','ss_{{ loop.index0 }}_longitude');
  {% endfor %}
});
</script>
{% endblock %}
